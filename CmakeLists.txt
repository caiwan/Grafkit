# GK2 root project
# caiwan/IR

cmake_minimum_required (VERSION 2.6)

project (Grafkit2)

enable_testing()
    
set_property(GLOBAL PROPERTY USE_FOLDERS ON)

message("CMAKE_PREFIX_PATH = ${CMAKE_PREFIX_PATH}")

SET(CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
SET(GK2_EXTERNALS "${CMAKE_CURRENT_SOURCE_DIR}/externals")

include (${CMAKE_CURRENT_SOURCE_DIR}/cmake/assign_source_group.cmake)
include (${CMAKE_CURRENT_SOURCE_DIR}/cmake/msvc_add_pch.cmake)
include (${CMAKE_CURRENT_SOURCE_DIR}/cmake/msvc_set_win32.cmake)
include (${CMAKE_CURRENT_SOURCE_DIR}/cmake/copy_static_files.cmake)
include (${CMAKE_CURRENT_SOURCE_DIR}/cmake/path_find_in_list.cmake)

if (CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    set (CMAKE_INSTALL_PREFIX "${CMAKE_BINARY_DIR}/deploy" CACHE PATH "default install path" FORCE )
endif()

find_package(Assimp)
find_package(stb)
find_package(Bass)
# find_package(Bullet)
find_package(GTest)

# --- 
# Setup tergars for dev and prod code

set(CMAKE_CONFIGURATION_TYPES 
	DevDebug 
	DevRelease 
	DevRelWithDebInfo 
	DevMinSizeRel 

	ProdDebug 
	ProdRelease 
	ProdRelWithDebInfo 
	ProdMinSizeRel 
CACHE TYPE INTERNAL FORCE)

if (MSVC12 OR MSVC14)
	set(LIVERELEASE_CXX_FLAGS "/DLIVE_RELEASE")
	set(LIVERELEASE_C_FLAGS "${LIVERELEASE_CXX_FLAGS}")
	
	set(DEVMODE_CXX_FLAGS "/DDEVELOPMENT_MODE")
	set(DEVMODE_C_FLAGS "${LIVERELEASE_CXX_FLAGS}")
endif()

set(CMAKE_CXX_FLAGS_DEVDEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${DEVMODE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_DEVRELEASE "${CMAKE_CXX_FLAGS_RELEASE} ${DEVMODE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_DEVRELWITHDEBINFO "${CMAKE_CXX_FLAGS_RELWITHDEBINFO} ${DEVMODE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_DEVMINSIZEREL "${CMAKE_CXX_FLAGS_MINSIZEREL} ${DEVMODE_CXX_FLAGS}")

set(CMAKE_C_FLAGS_DEVDEBUG "${CMAKE_C_FLAGS_DEBUG} ${DEVMODE_C_FLAGS}")
set(CMAKE_C_FLAGS_DEVRELEASE "${CMAKE_C_FLAGS_RELEASE} ${DEVMODE_C_FLAGS}")
set(CMAKE_C_FLAGS_DEVRELWITHDEBINFO "${CMAKE_C_FLAGS_RELWITHDEBINFO} ${DEVMODE_C_FLAGS}")
set(CMAKE_C_FLAGS_DEVMINSIZEREL "${CMAKE_C_FLAGS_MINSIZEREL} ${DEVMODE_C_FLAGS}")

set(CMAKE_EXE_LINKER_FLAGS_DEVDEBUG "${CMAKE_EXE_LINKER_FLAGS_DEBUG}")
set(CMAKE_EXE_LINKER_FLAGS_DEVRELEASE "${CMAKE_EXE_LINKER_FLAGS_RELEASE}")
set(CMAKE_EXE_LINKER_FLAGS_DEVRELWITHDEBINFO "${CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO}")
set(CMAKE_EXE_LINKER_FLAGS_DEVMINSIZEREL "${CMAKE_EXE_LINKER_FLAGS_MINSIZEREL}")

set(CMAKE_CXX_FLAGS_PRODDEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${LIVERELEASE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_PRODRELEASE "${CMAKE_CXX_FLAGS_RELEASE} ${LIVERELEASE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_PRODRELWITHDEBINFO "${CMAKE_CXX_FLAGS_RELWITHDEBINFO} ${LIVERELEASE_CXX_FLAGS}")
set(CMAKE_CXX_FLAGS_PRODMINSIZEREL "${CMAKE_CXX_FLAGS_MINSIZEREL} ${LIVERELEASE_CXX_FLAGS}")

set(CMAKE_C_FLAGS_PRODDEBUG "${CMAKE_C_FLAGS_DEBUG} ${LIVERELEASE_C_FLAGS}")
set(CMAKE_C_FLAGS_PRODRELEASE "${CMAKE_C_FLAGS_RELEASE} ${LIVERELEASE_C_FLAGS}")
set(CMAKE_C_FLAGS_PRODRELWITHDEBINFO "${CMAKE_C_FLAGS_RELWITHDEBINFO} ${LIVERELEASE_C_FLAGS}")
set(CMAKE_C_FLAGS_PRODMINSIZEREL "${CMAKE_C_FLAGS_MINSIZEREL} ${LIVERELEASE_C_FLAGS}")

set(CMAKE_EXE_LINKER_FLAGS_PRODDEBUG "${CMAKE_EXE_LINKER_FLAGS_DEBUG}")
set(CMAKE_EXE_LINKER_FLAGS_PRODRELEASE "${CMAKE_EXE_LINKER_FLAGS_RELEASE}")
set(CMAKE_EXE_LINKER_FLAGS_PRODRELWITHDEBINFO "${CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO}")
set(CMAKE_EXE_LINKER_FLAGS_PRODMINSIZEREL "${CMAKE_EXE_LINKER_FLAGS_MINSIZEREL}")

# ---

set(GK2_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src/framework")
set(GK2_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src")
set(GK2_ROOT_DIR "${CMAKE_CURRENT_SOURCE_DIR}")

add_subdirectory(src)

if (NOT GK_EXCLUDE_TESTS)
add_subdirectory(tests)
endif()
